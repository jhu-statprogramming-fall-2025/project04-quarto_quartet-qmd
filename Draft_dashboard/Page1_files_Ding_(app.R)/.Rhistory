summary_total <- summary_data %>%
group_by(Notification_year) %>%
summarise(
total_amount = sum(total_amount),
total_awards = sum(count_awards)
) %>%
arrange(Notification_year)
summary_pct <- summary_total %>%
arrange(Notification_year) %>%
mutate(
pct_change_funding_amount =
(total_amount - lag(total_amount)) / lag(total_amount) * 100,
pct_change_number_of_awards =
(total_awards - lag(total_awards)) / lag(total_awards) * 100
)
# Finla table
summary_pct
pct_2021_2025_funding_amount<-
(summary_total$total_amount[summary_total$Notification_year == 2025] -
summary_total$total_amount[summary_total$Notification_year == 2021]) /
summary_total$total_amount[summary_total$Notification_year == 2021] * 100
pct_2021_2025_number_of_awards <-
(summary_total$total_awards[summary_total$Notification_year == 2025] -
summary_total$total_awards[summary_total$Notification_year == 2021]) /
summary_total$total_awards[summary_total$Notification_year == 2021] * 100
pct_2021_2025_funding_amount
pct_2021_2025_number_of_awards
knitr::opts_chunk$set(echo = TRUE)
## -----------------------------
## Enter the 2x2x3 table
## -----------------------------
# Order: for each age stratum, vector is
# (Case,High), (Control,High), (Case,Low), (Control,Low)
alcohol_array <- array(
c(
8, 52, 5, 164,     # Age 35-44
25, 29, 21, 138,   # Age 45-54
50, 27, 61, 208    # Age 55-64
),
dim = c(2, 2, 3),
dimnames = list(
Disease = c("Case", "Control"),
Alcohol = c("High", "Low"),
Age     = c("35-44", "45-54", "55-64")
)
)
alcohol_array
## Stratum-specific ORs (a*d / b*c) in each age group
get_or <- function(mat) {
a <- mat["Case",   "High"]
b <- mat["Case",   "Low"]
c <- mat["Control","High"]
d <- mat["Control","Low"]
(a * d) / (b * c)
}
or_by_age <- sapply(1:3, function(i) get_or(alcohol_array[, , i]))
names(or_by_age) <- dimnames(alcohol_array)$Age
or_by_age
# Should be around: 35-44 ≈ 5.05, 45-54 ≈ 5.67, 55-64 ≈ 6.31
knitr::opts_chunk$set(echo = TRUE)
## -----------------------------
## Enter the 2x2x3 table
## -----------------------------
# Order: for each age stratum, vector is
# (Case,High), (Control,High), (Case,Low), (Control,Low)
alcohol_array <- array(
c(
8, 52, 5, 164,     # Age 35-44
25, 29, 21, 138,   # Age 45-54
50, 27, 61, 208    # Age 55-64
),
dim = c(2, 2, 3),
dimnames = list(
Disease = c("Case", "Control"),
Alcohol = c("High", "Low"),
Age     = c("35-44", "45-54", "55-64")
)
)
alcohol_array
## Stratum-specific ORs (a*d / b*c) in each age group
get_or <- function(mat) {
a <- mat["Case",   "High"]
b <- mat["Case",   "Low"]
c <- mat["Control","High"]
d <- mat["Control","Low"]
(a * d) / (b * c)
}
or_by_age <- sapply(1:3, function(i) get_or(alcohol_array[, , i]))
names(or_by_age) <- dimnames(alcohol_array)$Age
or_by_age
# Should be around: 35-44 ≈ 5.05, 45-54 ≈ 5.67, 55-64 ≈ 6.31
## Mantel–Haenszel test of association (common OR = 1)
mh_result <- mantelhaen.test(alcohol_array)
mh_result
mh_result$estimate        # common odds ratio (MH)
mh_result$conf.int        # 95% CI for the common OR
# 2x3 table: rows = origin, cols = genetic type
rp <- matrix(c(46, 25, 54,
1, 99, 10),
nrow = 2, byrow = TRUE)
dimnames(rp) <- list(
Origin = c("English", "Swiss"),
Type   = c("SexLinked", "Recessive", "Dominant")
)
rp
chisq.test(rp)    # chi-square test of independence
cases    <- c(7, 49, 516, 445, 299, 41)
controls <- c(61, 91, 615, 408, 162, 20)
# Labels for plotting (lower endpoints)
lower_end <- c(0, 1, 5, 15, 25, 50)
## -------------------------------
## Compute OR and log OR vs nonsmokers
## -------------------------------
# Baseline (non-smokers)
a0 <- cases[1]
b0 <- controls[1]
OR  <- numeric(6)
logOR <- numeric(6)
for (i in 1:6) {
a <- cases[i]
b <- controls[i]
OR[i]    <- (a * b0) / (b * a0)
logOR[i] <- log(OR[i])
}
OR
logOR
## -------------------------------
## Plot log OR vs cigarette dose
## -------------------------------
plot(lower_end[-1], logOR[-1], type = "b", pch = 19,
xlab = "Cigarettes per day (lower endpoint)",
ylab = "log(Odds Ratio) vs Non-smokers",
main = "Dose–Response Trend: Smoking and Lung Cancer")
abline(lm(logOR[-1] ~ lower_end[-1]), col = "red", lwd = 2)
logOR_table <- data.frame(
Cigarettes_day = c("0", "1-4", "5-14", "15-24", "25-49", "50+"),
log_OR = round(logOR, 3)
)
logOR_table
tab <- rbind(
cancer  = c(7,49,516,445,299,41),
control = c(61,91,615,408,162,20)
)
chisq.test(tab)
### (b)
#### H0: Smoking level is independent of lung cancer status. The distribution of cigarette consumption (0, 1–4, 5–14, 15–24, 25–49, 50+) is the same among lung cancer patients and controls.
## Observed counts in (first, second) order: MM, MF, FM, FF
obs <- c(MM = 218,
MF = 227,
FM = 278,
FF = 277)
## Expected probabilities under i.i.d. with P(M) = P(F) = 0.5
p0 <- rep(0.25, 4)
## Chi-square goodness-of-fit test
chisq.test(x = obs, p = p0)
## 2x2 table: rows = second child, cols = first child
tab <- matrix(c(218, 278,
227, 277),
nrow = 2, byrow = TRUE,
dimnames = list(
second = c("M", "F"),
first  = c("M", "F")
))
tab
## McNemar's test (by default uses continuity correction)
mcnemar.test(tab)
## If your instructor prefers *without* continuity correction:
mcnemar.test(tab, correct = FALSE)
## 2×2 contingency table for independence test
tab_indep <- matrix(c(218, 278,
227, 277),
nrow = 2, byrow = TRUE,
dimnames = list(
second = c("M", "F"),
first  = c("M", "F")
))
tab_indep
## Chi-square test of independence
chisq.test(tab_indep)
########################################
## Problem 5 – Bayesian new drug trial
## 18 successes out of 25
########################################
n  <- 25
x  <- 18          # number of improvements
p_hat <- x / n    # sample proportion
########################################
## (a) Posterior with prior Beta(1,1)
########################################
alpha0 <- 1
beta0  <- 1
alpha1 <- alpha0 + x
beta1  <- beta0  + (n - x)
alpha1; beta1    # should be 19 and 8
# Posterior: p | data ~ Beta(19, 8)
########################################
## (b) Posterior mean, mode, 95% CI
########################################
# Mean of Beta(a,b)
post_mean <- alpha1 / (alpha1 + beta1)
# Mode of Beta(a,b) when a,b > 1
post_mode <- (alpha1 - 1) / (alpha1 + beta1 - 2)
# 95% equal–tail credible interval
post_ci <- qbeta(c(0.025, 0.975), shape1 = alpha1, shape2 = beta1)
post_mean
post_mode
post_ci
########################################
## (c) Posterior probability p > 0.5
########################################
# P(p > 0.5 | data) = 1 - F_Beta(0.5)
post_prob_gt_0.5 <- 1 - pbeta(0.5, shape1 = alpha1, shape2 = beta1)
post_prob_gt_0.5
########################################
## Problem 5 – Bayesian new drug trial
## 18 successes out of 25
########################################
n  <- 25
x  <- 18          # number of improvements
p_hat <- x / n    # sample proportion
########################################
## (a) Posterior with prior Beta(1,1)
########################################
alpha0 <- 1
beta0  <- 1
alpha1 <- alpha0 + x
beta1  <- beta0  + (n - x)
alpha1; beta1    # should be 19 and 8
# Posterior: p | data ~ Beta(19, 8)
# Mean of Beta(a,b)
post_mean <- alpha1 / (alpha1 + beta1)
# Mode of Beta(a,b) when a,b > 1
post_mode <- (alpha1 - 1) / (alpha1 + beta1 - 2)
# 95% equal–tail credible interval
post_ci <- qbeta(c(0.025, 0.975), shape1 = alpha1, shape2 = beta1)
post_mean
post_mode
post_ci
## (c) Posterior probability p > 0.5
# P(p > 0.5 | data) = 1 - F_Beta(0.5)
post_prob_gt_0.5 <- 1 - pbeta(0.5, shape1 = alpha1, shape2 = beta1)
post_prob_gt_0.5
# Normal-approx CI for p
se_hat <- sqrt(p_hat * (1 - p_hat) / n)
freq_ci <- p_hat + c(-1, 1) * 1.96 * se_hat
# One-sided z test for H0: p = 0.5 vs p > 0.5
p0   <- 0.5
se0  <- sqrt(p0 * (1 - p0) / n)
z    <- (p_hat - p0) / se0
pval_one_sided <- 1 - pnorm(z)
p_hat
freq_ci
z
pval_one_sided
# Normal-approx CI for p
se_hat <- sqrt(p_hat * (1 - p_hat) / n)
freq_ci <- p_hat + c(-1, 1) * 1.96 * se_hat
# One-sided z test for H0: p = 0.5 vs p > 0.5
p0   <- 0.5
se0  <- sqrt(p0 * (1 - p0) / n)
z    <- (p_hat - p0) / se0
pval_one_sided <- 1 - pnorm(z)
freq_ci
pval_one_sided
# Normal-approx CI for p
se_hat <- sqrt(p_hat * (1 - p_hat) / n)
freq_ci <- p_hat + c(-1, 1) * 1.96 * se_hat
# One-sided z test for H0: p = 0.5 vs p > 0.5
p0   <- 0.5
se0  <- sqrt(p0 * (1 - p0) / n)
z    <- (p_hat - p0) / se0
pval_one_sided <- 1 - pnorm(z)
freq_ci
pval_one_sided
se_hat
alpha0_s <- 10
beta0_s  <- 10
alpha1_s <- alpha0_s + x
beta1_s  <- beta0_s  + (n - x)   # Beta(28, 17)
alpha1_s; beta1_s
# Posterior mean and mode
post_mean_s <- alpha1_s / (alpha1_s + beta1_s)
post_mode_s <- (alpha1_s - 1) / (alpha1_s + beta1_s - 2)
# 95% credible interval
post_ci_s <- qbeta(c(0.025, 0.975),
shape1 = alpha1_s,
shape2 = beta1_s)
# Posterior probability p > 0.5
post_prob_gt_0.5_s <- 1 - pbeta(0.5,
shape1 = alpha1_s,
shape2 = beta1_s)
post_mean_s
post_mode_s
post_ci_s
merged_data <- readRDS("~/Desktop/merged_data.rds")
library(lubridate)
library(dplyr)
library(ggplot2)
# 1. Summarise total award amount by Fiscal Year and Source
year_summary <- merged_data %>%
group_by(Notification_year, Source) %>%
summarise(
total_award = sum(Award_amount, na.rm = TRUE),
.groups = "drop"
)
year_summary_filtered <- year_summary %>%
filter(Notification_year != 2020, Notification_year != 2026)
# 3. Faceted plot
ggplot(year_summary_filtered,
aes(x = Notification_year, y = total_award, color = Source, group = Source)) +
geom_line(size = 1.3) +
geom_point(size = 3) +
geom_text(
aes(label = scales::comma(total_award)),
vjust = -0.6, size = 3
) +
labs(
title = "Award Amount Trends Over Time: NIH vs NSF (Year)",
x = "Year",
y = "Total Award Amount ($)"
) +
scale_y_continuous(labels = scales::comma) +
facet_wrap(~ Source, scales = "free_y", ncol = 1) +
coord_cartesian(expand = TRUE, clip = "off") +
theme_minimal(base_size = 14) +
theme(
plot.margin  = margin(20, 30, 20, 30),
legend.position = "none",
strip.text = element_text(size = 13)
)
library(dplyr)
library(tidyr)
award_amount_table <- merged_data %>%
filter(Source %in% c("NIH", "NSF"),
Notification_year != 2020,
Notification_year != 2026) %>%
group_by(Notification_year, Source) %>%
summarise(total_award_amount = sum(Award_amount, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = Source,
values_from = total_award_amount
) %>%
mutate(Total = NIH + NSF) %>%
arrange(Notification_year)
award_amount_table
library(lubridate)
library(dplyr)
library(ggplot2)
# 1. Summarise
year_count <- merged_data %>%
group_by(Notification_year, Source) %>%
summarise(
n_awards = n(),
.groups = "drop"
)
# 2. Remove 2020 and 2026
year_count_filtered <- year_count %>%
filter(Notification_year != 2020, Notification_year != 2026)
# 3. Faceted plot
ggplot(year_count_filtered,
aes(x = Notification_year, y = n_awards, color = Source, group = Source)) +
geom_line(size = 1.3) +
geom_point(size = 3) +
geom_text(
aes(label = scales::comma(n_awards)),
vjust = -0.6, size = 3
) +
labs(
title = "Number of Awards Over Time: NIH vs NSF (Year)",
x = "Year",
y = "Number of Awards"
) +
scale_y_continuous(labels = scales::comma) +
facet_wrap(~ Source, scales = "free_y", ncol = 1) +
coord_cartesian(expand = TRUE, clip = "off") +
theme_minimal(base_size = 14) +
theme(
plot.margin  = margin(20, 30, 20, 30),
legend.position = "none",
strip.text = element_text(size = 13)
)
award_count_table <- merged_data %>%
filter(Source %in% c("NIH", "NSF"),
Notification_year != 2020,
Notification_year != 2026) %>%                 #REMOVE 2020, 2026
group_by(Notification_year, Source) %>%
summarise(count = n(), .groups = "drop") %>%
pivot_wider(
names_from = Source,
values_from = count
) %>%
mutate(Total = NIH + NSF) %>%
arrange(Notification_year)
award_count_table
library(dplyr)
library(tidyr)
# calculating percentages for the summary_pct table
summary_data <- merged_data %>%
filter(Source %in% c("NIH", "NSF"),
Notification_year >= 2021,
Notification_year <= 2025) %>%
group_by(Notification_year, Source) %>%
summarise(
total_amount = sum(Award_amount, na.rm = TRUE),
count_awards = n(),
.groups = "drop"
)
summary_total <- summary_data %>%
group_by(Notification_year) %>%
summarise(
total_amount = sum(total_amount),
total_awards = sum(count_awards)
) %>%
arrange(Notification_year)
summary_pct <- summary_total %>%
arrange(Notification_year) %>%
mutate(
pct_change_funding_amount =
(total_amount - lag(total_amount)) / lag(total_amount) * 100,
pct_change_number_of_awards =
(total_awards - lag(total_awards)) / lag(total_awards) * 100
)
# Finla table
summary_pct
pct_2021_2025_funding_amount<-
(summary_total$total_amount[summary_total$Notification_year == 2025] -
summary_total$total_amount[summary_total$Notification_year == 2021]) /
summary_total$total_amount[summary_total$Notification_year == 2021] * 100
pct_2021_2025_number_of_awards <-
(summary_total$total_awards[summary_total$Notification_year == 2025] -
summary_total$total_awards[summary_total$Notification_year == 2021]) /
summary_total$total_awards[summary_total$Notification_year == 2021] * 100
pct_2021_2025_funding_amount
pct_2021_2025_number_of_awards
View(merged_data)
View(merged_data)
shiny::runApp('Desktop/Dashboard/Funding')
install.packages(c("shiny", "shinydashboard", "tidyverse"))
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
install.packages("DT")
shiny::runApp()
install.packages("bslib")
shiny::runApp()
install.packages("bslib")
shiny::runApp()
runApp()
knitr::opts_chunk$set(echo = TRUE)
library(tibble)
library(dplyr)
library(readr)
data_dictionary <- tribble(
~Composite_Variable_Name, ~Variable_Type, ~Source, ~Variable,           ~Description,                                                                                 ~Values,
"ID",                     "KEY (string)", "NIH",   "Project Number",    "Full NIH project number used as a unique identifier linking to publications and patents.",   "Example: 1K23HL167650-01A1",
"ID",                     "KEY (string)", "NSF",   "Award number",      "7-digit unique identifier of award record in NSF database.",                                "Example: 2045678",
"Title",                  "TEXT",         "NIH",   "Project Title",     "Title of the funded grant, contract, or intramural project.",                               NA,
"Title",                  "TEXT",         "NSF",   "Title",             "Title of the funded grant or project.",                                                     NA,
"Abstract",               "TEXT",         "NIH",   "Project Abstract",  "Statement articulating a project’s potential to improve public health.",                     NA,
"Abstract",               "TEXT",         "NSF",   "Abstract",          "Statement detailing the project’s background, scientific relevance, and impact.",           NA,
"Funding_organization",   "CATEGORICAL",  "NIH",   "Administering IC",  "Acronym for the NIH Institute or Center(s) providing funding.",                             "e.g., NCI, NIAID, NHLBI, NIMH, NIGMS, etc.",
"Funding_organization",   "CATEGORICAL",  "NSF",   "NSF Organization",  "Acronym for the NSF directorate or office providing funding.",                               "e.g., BCS, MCB, etc.",
"Activity",               "CATEGORICAL",  "NIH",   "Activity",          "3-character code identifying the grant or contract activity.",                              "e.g., R01, K08, U01",
"Activity_category",      "CATEGORICAL",  "NIH",   "Activity category", "1-character code identifying the category of the grant or project.",                        "e.g., R = research project, K = career development, U = cooperative agreement",
"Organization_name",      "TEXT",         "Both",  "Organization Name", "Name of the institution, research organization, business, or agency receiving funding.",     NA,
"Organization_city",      "LOCATION",     "Both",  "Organization City", "City of the business office of the grantee organization or contractor.",                    NA,
"Organization_state",     "LOCATION",     "Both",  "Organization State","2-character abbreviation for the state of the grantee organization or contractor.",         "e.g., CA, MD, NY",
"Start_date",             "DATE",         "Both",  "Start Date",        "Start date of a project; for multi-project grants, the start date of the parent award.",    "After 01/01/2021",
"End_date",               "DATE",         "Both",  "End Date",          "End date of a project; for multi-project grants, the end date of the parent award.",        NA,
"Year",                   "YEAR",         "Both",  "Fiscal Year",       "Fiscal year from which project funds were obligated (2021–2026).",                          "2021–2026",
"Notification_date",      "DATE",         "NIH",   "Award Notice Date", "Date of NIH award notice or Notice of Grant Award.",                                        "After 01/01/2021",
"Notification_date",      "DATE",         "NSF",   "Last Amendment Date","Date of last application amendment (used as surrogate for award notice date).",            "After 01/01/2021",
"Award_amount",           "NUMERICAL",    "NIH",   "Total Cost",        "Total project funding from all NIH Institutes and Centers for a given fiscal year.",       "In USD ($)",
"Award_amount",           "NUMERICAL",    "NSF",   "Awarded amount",    "Total funding awarded to date for the NSF project.",                                        "In USD ($)"
)
# write to CSV in your app folder
write_csv(data_dictionary, "data_dictionary.csv")
library(tibble)
library(dplyr)
library(readr)
data_dictionary <- tribble(
~Composite_Variable_Name, ~Variable_Type, ~Source, ~Variable,           ~Description,                                                                                 ~Values,
"ID",                     "KEY (string)", "NIH",   "Project Number",    "Full NIH project number used as a unique identifier linking to publications and patents.",   "Example: 1K23HL167650-01A1",
"ID",                     "KEY (string)", "NSF",   "Award number",      "7-digit unique identifier of award record in NSF database.",                                "Example: 2045678",
"Title",                  "TEXT",         "NIH",   "Project Title",     "Title of the funded grant, contract, or intramural project.",                               NA,
"Title",                  "TEXT",         "NSF",   "Title",             "Title of the funded grant or project.",                                                     NA,
"Abstract",               "TEXT",         "NIH",   "Project Abstract",  "Statement articulating a project’s potential to improve public health.",                     NA,
"Abstract",               "TEXT",         "NSF",   "Abstract",          "Statement detailing the project’s background, scientific relevance, and impact.",           NA,
"Funding_organization",   "CATEGORICAL",  "NIH",   "Administering IC",  "Acronym for the NIH Institute or Center(s) providing funding.",                             "e.g., NCI, NIAID, NHLBI, NIMH, NIGMS, etc.",
"Funding_organization",   "CATEGORICAL",  "NSF",   "NSF Organization",  "Acronym for the NSF directorate or office providing funding.",                               "e.g., BCS, MCB, etc.",
"Activity",               "CATEGORICAL",  "NIH",   "Activity",          "3-character code identifying the grant or contract activity.",                              "e.g., R01, K08, U01",
"Activity_category",      "CATEGORICAL",  "NIH",   "Activity category", "1-character code identifying the category of the grant or project.",                        "e.g., R = research project, K = career development, U = cooperative agreement",
"Organization_name",      "TEXT",         "Both",  "Organization Name", "Name of the institution, research organization, business, or agency receiving funding.",     NA,
"Organization_city",      "LOCATION",     "Both",  "Organization City", "City of the business office of the grantee organization or contractor.",                    NA,
"Organization_state",     "LOCATION",     "Both",  "Organization State","2-character abbreviation for the state of the grantee organization or contractor.",         "e.g., CA, MD, NY",
"Start_date",             "DATE",         "Both",  "Start Date",        "Start date of a project; for multi-project grants, the start date of the parent award.",    "After 01/01/2021",
"End_date",               "DATE",         "Both",  "End Date",          "End date of a project; for multi-project grants, the end date of the parent award.",        NA,
"Year",                   "YEAR",         "Both",  "Fiscal Year",       "Fiscal year from which project funds were obligated (2021–2026).",                          "2021–2026",
"Notification_date",      "DATE",         "NIH",   "Award Notice Date", "Date of NIH award notice or Notice of Grant Award.",                                        "After 01/01/2021",
"Notification_date",      "DATE",         "NSF",   "Last Amendment Date","Date of last application amendment (used as surrogate for award notice date).",            "After 01/01/2021",
"Award_amount",           "NUMERICAL",    "NIH",   "Total Cost",        "Total project funding from all NIH Institutes and Centers for a given fiscal year.",       "In USD ($)",
"Award_amount",           "NUMERICAL",    "NSF",   "Awarded amount",    "Total funding awarded to date for the NSF project.",                                        "In USD ($)"
)
# write to CSV in your app folder
write_csv(data_dictionary, "data_dictionary.csv")
# load data
merged_data <- readRDS("merged_data.rds")
runApp()
runApp()
runApp()
